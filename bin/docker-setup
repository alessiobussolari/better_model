#!/usr/bin/env sh
# Setup script for Docker development environment
# Run this once to build the Docker image and prepare the development environment

set -e

echo "ðŸ³ Setting up BetterModel Docker development environment..."
echo ""

# Check if Docker is installed
if ! command -v docker > /dev/null 2>&1; then
  echo "âŒ Error: Docker is not installed."
  echo "Please install Docker from https://docs.docker.com/get-docker/"
  exit 1
fi

# Check if Docker Compose is available
if ! docker compose version > /dev/null 2>&1; then
  echo "âŒ Error: Docker Compose is not available."
  echo "Please install Docker Compose or update Docker to a version that includes it."
  exit 1
fi

echo "âœ“ Docker is installed and running"
echo ""

# Build the Docker images
echo "ðŸ“¦ Building Docker images..."
docker compose build

echo ""
echo "âœ“ Docker images built successfully"
echo ""

# Install dependencies
echo "ðŸ“š Installing gem dependencies..."
docker compose run --rm app bundle install

echo ""
echo "âœ“ Dependencies installed successfully"
echo ""

# Prepare test database
echo "ðŸ—„ï¸  Preparing test database..."
docker compose run --rm app bundle exec rake db:test:prepare 2>/dev/null || echo "âœ“ Test database ready (or not needed)"

echo ""
echo "ðŸŽ‰ Setup complete!"
echo ""
echo "You can now use the following commands:"
echo "  bin/docker-test      - Run the test suite"
echo "  bin/docker-rubocop   - Run RuboCop linter"
echo "  docker compose run --rm app bash - Open a shell in the container"
echo ""
